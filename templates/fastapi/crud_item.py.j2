#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
项目CRUD操作

这个模块提供了项目的CRUD（创建、读取、更新、删除）操作。
"""

from typing import List, Optional

from sqlalchemy import select
from sqlalchemy.ext.asyncio import AsyncSession

from app.db.base import CRUDBase
from app.models.item import Item
from app.schemas.item import ItemCreate, ItemUpdate


class CRUDItem(CRUDBase[Item, ItemCreate, ItemUpdate]):
    """
    项目CRUD操作
    """
    
    async def create(
        self, db: AsyncSession, *, obj_in: ItemCreate
    ) -> Item:
        """
        创建项目
        
        Args:
            db: 数据库会话
            obj_in: 创建项目的数据
            
        Returns:
            Item: 创建的项目实例
        """
        db_obj = Item(
            title=obj_in.title,
            description=obj_in.description,
        )
        db.add(db_obj)
        await db.commit()
        await db.refresh(db_obj)
        return db_obj
    
    async def get_multi(
        self, db: AsyncSession, *, skip: int = 0, limit: int = 100
    ) -> List[Item]:
        """
        获取多个项目
        
        Args:
            db: 数据库会话
            skip: 跳过的记录数
            limit: 返回的记录数
            
        Returns:
            List[Item]: 项目列表
        """
        query = select(self.model).offset(skip).limit(limit)
        result = await db.execute(query)
        return result.scalars().all()


item_crud = CRUDItem(Item)